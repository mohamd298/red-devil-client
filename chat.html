<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red Devil Chat</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
<div class="chat-container">
  <div id="messages"></div>
  <input id="msg" placeholder="اكتب رسالة">
  <button onclick="sendMsg()">إرسال</button>
</div>

<script>
const socket = io("PUT_RENDER_URL_HERE");
const token = localStorage.getItem("token");

async function getUser() {
  const res = await fetch("https://red-devil-server.onrender.com/users.json");
  const users = await res.json();
  return Object.values(users).find(u => u.token === token);
}

async function sendMsg() {
  const input = document.getElementById("msg");
  const text = input.value.trim();
  if(!text) return;
  const user = await getUser();
  socket.emit("msg", { user: user.name, avatar: user.avatar, text });
  input.value = "";
}

socket.on("msg", data => {
  const messages = document.getElementById("messages");
  const div = document.createElement("div");
  div.className = "msg";
  div.innerHTML = `<img src="${data.avatar}" class="avatar"><b>${data.user}:</b> ${data.text}`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
});
</script>
</body>
</html>
